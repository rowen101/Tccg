@model PagedList.IPagedList<tccgv2.Models.clsInvoiceList>
@using PagedList.Mvc;

@{
    ViewBag.Title = "TCCG | Invoice List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<p class="lead">Invoice List</p>

<p>
    @Html.ActionLink("Create Invoice", "create-invoice")
</p>
<div class="text-right">
    <div class="input-append">
        <input class="span2" id="appendedInputButtons" type="text">
        <button class="btn" type="button">Search</button>
    </div>
</div>
<table class="table table-hover table-condensed">
    <tr>
            <th></th>
        <th>
          Invoice #
        </th>
        <th>
            Date
        </th>
        <th>
            Customer Name
        </th>
        <th>
           Total 
        </th>
        <th>
            Paid Status
        </th>
        <th>
           Post Status
        </th>
    
    </tr>

@foreach (var item in Model) {
    <tr> 
         <td>
             <a href="#"  onclick="edit('@item.Invoice_num')">Edit</a>|
             @Html.ActionLink("Preview", "preview-invoice-report","Preview", new { id = item.Invoice_num }, new  { target="_blank"})
           
        <td>
            @Html.DisplayFor(modelItem => item.Invoice_num)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Invoice_date)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Customer_name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Total_amt)
        </td>
        <td>
            @Html.DisplayFor(modelItem=> item.PaidStatus)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.status)
        </td>

    </tr>
}

</table>
Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount

@Html.PagedListPager(Model, p => Url.Action("invoice-transaction",
    new { p, systemid = ViewBag.currentsystem }))


<script>

    function edit(param) {
        try {

            var jsonData = JSON.stringify({ invoicenum: param }, null, 2);

            $.ajax({
                url: '@Url.Content("~/JsonResult/check-invoice/")',
                type: 'POST',
                data: jsonData,
                datatype: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data.result == true) {

                        if (data.isreuslt == true) {
                            window.location.replace('@Url.Content("~/Transaction/modify-invoice/")' + param);
                        }
                        else {
                            alert('Invalid to Update this Invoice # :' + param );
                        }

                    }
                    else {
                        alert(data.err.toString());
                    }

                },
                error: function (request, status, err) {
                    alert(status);
                    alert(err);
                }
            });
        }
        catch (err) {
            alert(err.message);
        }
    }

</script>